<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Audio Tour Agent - Powered by NetMind</title>
    <meta name="description" content="Generate personalized audio tours with AI-powered research and expressive speech synthesis using NetMind API">
    <meta name="keywords" content="AI, audio tour, travel, NetMind, TTS, tour guide">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2E86AB;
            --secondary-color: #A23B72;
            --accent-color: #F18F01;
            --background-color: #F8F9FA;
            --text-color: #212529;
            --border-color: #DEE2E6;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .welcome-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border-left: 5px solid var(--accent-color);
        }
        
        .form-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid var(--border-color);
            padding: 12px 15px;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(46, 134, 171, 0.25);
        }
        
        .progress {
            height: 25px;
            border-radius: 15px;
            background-color: #E9ECEF;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 15px;
            transition: width 0.3s ease;
        }
        
        .audio-player {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin: 2rem 0;
        }
        
        .footer {
            background-color: #F8F9FA;
            padding: 2rem 0;
            margin-top: 3rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }
        
        .netmind-branding {
            color: #6C757D;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .btn-netmind {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }
        
        .btn-netmind:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            color: white;
            text-decoration: none;
        }
        
        .loading {
            display: none;
        }
        
        .alert {
            border-radius: 10px;
            border: none;
        }
        
        .interest-checkbox {
            margin: 0.5rem 0;
        }
        
        .range-output {
            font-weight: 600;
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h1 class="display-4 mb-3">
                        <i class="fas fa-map-marked-alt me-3"></i>
                        AI Audio Tour Agent
                    </h1>
                    <p class="lead">Generate personalized audio tours with AI-powered research and expressive speech synthesis</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="container">
        <!-- Welcome Card -->
        <div class="welcome-card">
            <h3><i class="fas fa-star text-warning me-2"></i>Welcome to Your Personal Tour Guide!</h3>
            <p class="mb-0">Enter your destination and interests below to generate a personalized audio tour. Our AI will research the location and create an engaging narrative with natural-sounding speech.</p>
        </div>
        
        <!-- Form Section -->
        <div class="form-section">
            <form id="tourForm">
                <div class="row">
                    <!-- Left Column -->
                    <div class="col-md-6">
                        <div class="mb-4">
                            <label for="location" class="form-label">
                                <i class="fas fa-map-marker-alt me-2"></i>Location
                            </label>
                            <input type="text" class="form-control" id="location" placeholder="Enter a city, landmark, or address" required>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-heart me-2"></i>Interests (Select all that apply)
                            </label>
                            <div class="interest-checkbox">
                                <input type="checkbox" class="form-check-input" id="architecture" value="Architecture">
                                <label class="form-check-label ms-2" for="architecture">Architecture</label>
                            </div>
                            <div class="interest-checkbox">
                                <input type="checkbox" class="form-check-input" id="history" value="History">
                                <label class="form-check-label ms-2" for="history">History</label>
                            </div>
                            <div class="interest-checkbox">
                                <input type="checkbox" class="form-check-input" id="culinary" value="Culinary">
                                <label class="form-check-label ms-2" for="culinary">Culinary</label>
                            </div>
                            <div class="interest-checkbox">
                                <input type="checkbox" class="form-check-input" id="culture" value="Culture">
                                <label class="form-check-label ms-2" for="culture">Culture</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column -->
                    <div class="col-md-6">
                        <div class="mb-4">
                            <label for="duration" class="form-label">
                                <i class="fas fa-clock me-2"></i>Tour Duration: <span id="durationValue" class="range-output">5 minutes</span>
                            </label>
                            <input type="range" class="form-range" id="duration" min="3" max="15" value="5" step="1">
                        </div>
                        
                        <div class="mb-4">
                            <label for="voiceStyle" class="form-label">
                                <i class="fas fa-microphone me-2"></i>Voice Style
                            </label>
                            <select class="form-select" id="voiceStyle">
                                <option value="friendly">Friendly</option>
                                <option value="professional">Professional</option>
                                <option value="enthusiastic">Enthusiastic</option>
                                <option value="calm">Calm</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label for="apiKey" class="form-label">
                                <i class="fas fa-key me-2"></i>NetMind API Key
                            </label>
                            <input type="password" class="form-control" id="apiKey" placeholder="Enter your NetMind API key" required>
                            <div class="form-text">Get your API key from <a href="https://www.netmind.ai" target="_blank">NetMind.ai</a></div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-magic me-2"></i>Generate Audio Tour
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Progress Section -->
        <div id="progressSection" class="loading">
            <div class="form-section">
                <h4 class="mb-3">Generating Your Tour...</h4>
                <div class="progress mb-3">
                    <div class="progress-bar" role="progressbar" style="width: 0%" id="progressBar">
                        <span id="progressText">Starting...</span>
                    </div>
                </div>
                <p id="statusText" class="text-muted">Initializing tour generation...</p>
            </div>
        </div>
        
        <!-- Audio Player Section -->
        <div id="audioSection" class="loading">
            <div class="audio-player">
                <h4 class="mb-3"><i class="fas fa-headphones me-2"></i>Your Audio Tour is Ready!</h4>
                <audio id="audioPlayer" controls class="w-100 mb-3">
                    Your browser does not support the audio element.
                </audio>
                <div class="mt-3">
                    <a id="downloadLink" class="btn btn-success me-2" download="audio_tour.mp3">
                        <i class="fas fa-download me-2"></i>Download Audio
                    </a>
                    <button class="btn btn-secondary" onclick="resetForm()">
                        <i class="fas fa-redo me-2"></i>Generate Another Tour
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Error Section -->
        <div id="errorSection" class="loading">
            <div class="alert alert-danger" role="alert">
                <h4 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Error</h4>
                <p id="errorMessage">An error occurred while generating your tour.</p>
                <button class="btn btn-outline-danger" onclick="resetForm()">
                    <i class="fas fa-redo me-2"></i>Try Again
                </button>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <div class="netmind-branding">
                Powered by NetMind Inference API
            </div>
            <a href="https://www.netmind.ai/modelsLibrary" target="_blank" class="btn-netmind">
                <i class="fas fa-rocket me-2"></i>Explore NetMind Model Library
            </a>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- NetMind API Integration -->
    <script src="api.js"></script>
    
    <script>
        // Update duration display
        document.getElementById('duration').addEventListener('input', function() {
            document.getElementById('durationValue').textContent = this.value + ' minutes';
        });
        
        // Form submission
        document.getElementById('tourForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form data
            const location = document.getElementById('location').value;
            const duration = document.getElementById('duration').value;
            const voiceStyle = document.getElementById('voiceStyle').value;
            const apiKey = document.getElementById('apiKey').value;
            
            // Get selected interests
            const interests = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                interests.push(checkbox.value);
            });
            
            if (interests.length === 0) {
                alert('Please select at least one interest.');
                return;
            }
            
            // Show progress section
            showSection('progressSection');
            
            try {
                await generateTour(location, interests, duration, voiceStyle, apiKey);
            } catch (error) {
                showError(error.message);
            }
        });
        
        async function generateTour(location, interests, duration, voiceStyle, apiKey) {
            updateProgress(10, 'Initializing tour generation...');
            
            try {
                // Initialize NetMind API
                const api = new NetMindAPI(apiKey);
                
                updateProgress(25, 'Researching location and interests...');
                
                // Generate tour content using NetMind API
                const result = await api.generateTourContent(location, interests, duration, voiceStyle);
                
                updateProgress(100, 'Tour generation complete!');
                
                // Create audio URL from blob
                const audioUrl = URL.createObjectURL(result.audio);
                
                // Show audio player
                setTimeout(() => {
                    showAudio(audioUrl);
                }, 500);
                
            } catch (error) {
                console.error('Tour generation failed:', error);
                
                // Check if it's a CORS error
                if (error.message.includes('CORS') || error.message.includes('fetch')) {
                    showError('CORS Error: Direct API calls are blocked by the browser. Please use the Python Streamlit version or deploy with a backend proxy. See DEPLOYMENT.md for details.');
                } else {
                    showError(`Error: ${error.message}. Please check your API key and try again.`);
                }
            }
        }
        
        function updateProgress(percent, message) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const statusText = document.getElementById('statusText');
            
            progressBar.style.width = percent + '%';
            progressText.textContent = percent + '%';
            statusText.textContent = message;
        }
        
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.loading').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show target section
            document.getElementById(sectionId).style.display = 'block';
        }
        
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            showSection('errorSection');
        }
        
        function showAudio(audioUrl) {
            const audioPlayer = document.getElementById('audioPlayer');
            const downloadLink = document.getElementById('downloadLink');
            
            audioPlayer.src = audioUrl;
            downloadLink.href = audioUrl;
            
            showSection('audioSection');
        }
        
        function resetForm() {
            document.getElementById('tourForm').reset();
            document.getElementById('durationValue').textContent = '5 minutes';
            document.querySelectorAll('.loading').forEach(section => {
                section.style.display = 'none';
            });
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>