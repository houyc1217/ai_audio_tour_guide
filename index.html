<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>AI Audio Tour Agent</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/browser@0.85.1/build/stlite.css" />
    <script type="module" src="https://cdn.jsdelivr.net/npm/@stlite/browser@0.85.1/build/stlite.js"></script>
</head>
<body>
    <streamlit-app>
        <app-file name="streamlit_app.py" entrypoint>
import streamlit as st
import asyncio
import json
import time
import requests
from typing import List, Dict, Any

# NetMind API Configuration
class NetMindConfig:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = "https://api.netmind.ai/v1"
        self.headers = {
            "Authorization": f"Bearer {api_key}",
            "Content-Type": "application/json"
        }
    
    def chat_completion(self, messages: List[Dict], model: str = "gpt-oss-20b"):
        """Simple chat completion for content generation"""
        try:
            response = requests.post(
                f"{self.base_url}/chat/completions",
                headers=self.headers,
                json={
                    "model": model,
                    "messages": messages,
                    "max_tokens": 2000,
                    "temperature": 0.7
                },
                timeout=30
            )
            if response.status_code == 200:
                return response.json()["choices"][0]["message"]["content"]
            else:
                return f"Error: {response.status_code} - {response.text}"
        except Exception as e:
            return f"Request failed: {str(e)}"

# Simple Tour Manager for stlite
class SimpleTourManager:
    def __init__(self, netmind_config):
        self.netmind = netmind_config
    
    def generate_tour_content(self, location: str, interests: List[str], duration: int) -> str:
        """Generate tour content using NetMind API"""
        
        # Calculate approximate word count based on duration
        words_per_minute = 150  # Average speaking pace
        target_words = duration * words_per_minute
        
        # Create comprehensive prompt
        interests_str = ", ".join(interests)
        
        prompt = f"""Create an engaging audio tour guide script for {location}.
        
Focus on these interests: {interests_str}
Target length: approximately {target_words} words (for {duration} minutes of audio)
        
Requirements:
- Write in a conversational, engaging tone suitable for audio
- Include fascinating stories, historical facts, and local insights
- Structure with clear sections for each interest area
- Use vivid descriptions that help listeners visualize the locations
- Include practical tips and hidden gems
- Make it feel like a knowledgeable local friend is giving the tour
        
Format the response as a flowing narrative suitable for text-to-speech conversion."""
        
        messages = [
            {"role": "system", "content": "You are an expert tour guide with deep knowledge of world destinations. Create engaging, informative audio tour content."},
            {"role": "user", "content": prompt}
        ]
        
        return self.netmind.chat_completion(messages)

# Set page config
st.set_page_config(
    page_title="AI Audio Tour Agent",
    layout="wide",
    initial_sidebar_state="collapsed"
)

# Initialize NetMind configuration
if 'netmind_config' not in st.session_state:
    # Using the provided API key
    api_key = "b3e08a955ca24e9e80ffd7f073c2a010"
    st.session_state.netmind_config = NetMindConfig(api_key)
    st.session_state.tour_manager = SimpleTourManager(st.session_state.netmind_config)

# Main UI
st.title("üéß AI Audio Tour Agent")
st.markdown("""
<div style='background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); 
            padding: 20px; border-radius: 10px; margin-bottom: 30px;'>
    <h3 style='color: white; margin: 0;'>Welcome to your personalized audio tour guide!</h3>
    <p style='color: white; margin: 10px 0 0 0;'>Explore any location with an engaging, AI-generated tour tailored to your interests.</p>
</div>
""", unsafe_allow_html=True)

# Create layout
col1, col2 = st.columns([2, 1])

with col1:
    st.markdown("### üìç Where would you like to explore?")
    location = st.text_input(
        "Location", 
        placeholder="Enter a city, landmark, or location...",
        label_visibility="collapsed"
    )
    
    st.markdown("### üéØ What interests you?")
    interests = st.multiselect(
        "Interests",
        options=["History", "Architecture", "Culinary", "Culture"],
        default=["History", "Architecture"],
        help="Select the topics you'd like to learn about",
        label_visibility="collapsed"
    )

with col2:
    st.markdown("### ‚è±Ô∏è Tour Settings")
    duration = st.slider(
        "Tour Duration (minutes)",
        min_value=1,
        max_value=20,
        value=5,
        step=1,
        help="Choose how long you'd like your tour to be"
    )
    
    st.markdown("### üé§ Voice Style")
    voice_style = st.selectbox(
        "Guide's Voice Style",
        options=["Friendly & Casual", "Professional & Detailed", "Enthusiastic & Energetic"],
        help="Select the personality of your tour guide"
    )

# Generate Tour Button
if st.button("üöÄ Generate Tour", type="primary", use_container_width=True):
    if not location:
        st.error("Please enter a location.")
    elif not interests:
        st.error("Please select at least one interest category.")
    else:
        with st.spinner(f"Creating your personalized tour of {location}..."):
            try:
                # Generate tour content
                tour_content = st.session_state.tour_manager.generate_tour_content(
                    location, interests, duration
                )
                
                # Display the tour content
                st.markdown("---")
                st.markdown("## üìñ Your Personalized Tour")
                
                # Create an attractive display for the tour content
                st.markdown(
                    f"""
                    <div style='background: #f8f9fa; padding: 20px; border-radius: 10px; 
                               border-left: 4px solid #667eea; margin: 20px 0;'>
                        <h4 style='color: #333; margin-top: 0;'>üéØ {location} Tour</h4>
                        <p style='color: #666; margin-bottom: 15px;'>
                            <strong>Interests:</strong> {', '.join(interests)} | 
                            <strong>Duration:</strong> {duration} minutes | 
                            <strong>Style:</strong> {voice_style}
                        </p>
                    </div>
                    """,
                    unsafe_allow_html=True
                )
                
                # Display tour content in expandable section
                with st.expander("üìù Tour Content", expanded=True):
                    st.markdown(tour_content)
                
                # Audio generation note (since TTS is complex for stlite)
                st.info("""
                    üéµ **Audio Generation Note**: 
                    In this browser-based version, audio generation is simplified. 
                    For full TTS functionality, please use the server-based version.
                    You can copy the text above and use any text-to-speech service.
                """)
                
                # Download option for the text
                st.download_button(
                    label="üìÑ Download Tour Text",
                    data=tour_content,
                    file_name=f"{location.lower().replace(' ', '_')}_tour.txt",
                    mime="text/plain"
                )
                
                st.success("‚úÖ Tour generated successfully using NetMind AI!")
                
            except Exception as e:
                st.error(f"‚ùå Error generating tour: {str(e)}")
                st.info("Please check your internet connection and try again.")

# Footer with NetMind branding
st.markdown("---")
col1, col2, col3 = st.columns([1, 2, 1])
with col2:
    st.markdown(
        """
        <div style='text-align: center; padding: 20px;'>
            <p style='color: #666; font-size: 14px; margin-bottom: 10px;'>‚ö° Powered by NetMind Inference API</p>
        </div>
        """, 
        unsafe_allow_html=True
    )
    
    # NetMind link button
    if st.button("üöÄ Explore NetMind Model Library", use_container_width=True):
        st.markdown(
            """
            <script>
                window.open('https://www.netmind.ai/modelsLibrary', '_blank');
            </script>
            """,
            unsafe_allow_html=True
        )
        st.success("Opening NetMind Model Library in a new tab...")
        st.markdown("[Click here if the page didn't open automatically](https://www.netmind.ai/modelsLibrary)")

# Add some custom CSS for better styling
st.markdown("""
<style>
    .stButton > button {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 5px;
        padding: 0.5rem 1rem;
        font-weight: 500;
    }
    
    .stButton > button:hover {
        background: linear-gradient(90deg, #5a6fd8 0%, #6a4190 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .stSelectbox > div > div {
        border-radius: 5px;
    }
    
    .stTextInput > div > div > input {
        border-radius: 5px;
    }
    
    .stMultiSelect > div > div {
        border-radius: 5px;
    }
</style>
""", unsafe_allow_html=True)
        </app-file>
        <app-requirements>
            requests
        </app-requirements>
    </streamlit-app>
</body>
</html>